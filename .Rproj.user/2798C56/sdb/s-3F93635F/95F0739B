{
    "contents" : "# Required libraries\nlibrary(lubridate)\nlibrary(beanplot)\nlibrary(doBy)\nlibrary(modeest)\nlibrary(plyr)\nlibrary(psych)\n\n# We can each add in our working directories here - just un# and # as you check code out and back in\n# setwd(\"C:/Users/Jim Braun/My Documents/Predict 498 Capstone/Data Mining Cup\")\n#\n#\n#\n\n# Read in data from Google Drive\n# Need to update path\norders.train <- read.table(\"C:/Users/Katie/Google Drive/Predict 498 Capstone/orders_train.txt\", header = TRUE, sep = \";\")\n# Jim's path\norders.train <- read.table(\"C:/Users/Jim Braun/My Documents/Predict 498 Capstone/Data Mining Cup/orders_train.txt\", header = TRUE, sep = \";\")\nstr(orders.train)\n\n# Update date fields to date type instead of factors\norders.train$orderDate <- as.Date(orders.train$orderDate, format = \"%Y-%m-%d\")\norders.train$deliveryDate <- as.Date(orders.train$deliveryDate, format = \"%Y-%m-%d\")\norders.train$dateOfBirth <- as.Date(orders.train$dateOfBirth, format = \"%Y-%m-%d\")\norders.train$creationDate <- as.Date(orders.train$creationDate, format = \"%Y-%m-%d\")\nstr(orders.train)\n\nsummary(orders.train)\n\n# Add date diff variables\norders.train$timeToDeliver <- as.numeric(difftime(orders.train$deliveryDate,orders.train$orderDate,unit=\"days\"))\norders.train$accountAge <- as.numeric(difftime(orders.train$orderDate,orders.train$creationDate,unit=\"weeks\"))/52.25\norders.train$customerAge <- as.numeric(difftime(orders.train$orderDate,orders.train$dateOfBirth,unit=\"weeks\"))/52.25\n\n# Check\nsummary(orders.train[15:17])\n\n# timeToDeliver should never be negative, and age should never be negative\norders.train$timeToDeliver <- ifelse(orders.train$timeToDeliver<0,NA,orders.train$timeToDeliver)\norders.train$customerAge <- ifelse(orders.train$customerAge<0,NA,orders.train$customerAge)\n# age should also probably not be > 100 - what should we use for the cut-off?\norders.train$customerAge <- ifelse(orders.train$customerAge>100,NA,orders.train$customerAge)\n\n# Recheck\nsummary(orders.train[15:17])\n\n# Look at PDF of numeric variables given reponse\n# Note that we're just using a random sample due to processing time for graphics\nset.seed(498)\nsample_ind <- sample(seq_len(nrow(orders.train)), size = 1000)\norders.sample <- orders.train [sample_ind, ]\nbeanplot(customerAge ~ returnShipment, orders.sample, side = \"b\", col = list(\"yellow\", \"orange\"), border = c(\"yellow2\",\"darkorange\"), main = \"Customer Age Distribution\", ylab = \"Age in Years\", xaxt=\"n\")\nlegend(\"topleft\", bty=\"n\",c(\"Not Returned\", \"Returned\"), fill = c(\"yellow\", \"orange\"))\nbeanplot(accountAge ~ returnShipment, orders.sample, side = \"b\", col = list(\"yellow\", \"orange\"), border = c(\"yellow2\",\"darkorange\"), main = \"Account Age Distribution\", ylab = \"Age in Years\", xaxt=\"n\")\nlegend(\"topleft\", bty=\"n\",c(\"Not Returned\", \"Returned\"), fill = c(\"yellow\", \"orange\"))\nbeanplot(timeToDeliver ~ returnShipment, orders.sample, side = \"b\", col = list(\"yellow\", \"orange\"), border = c(\"yellow2\",\"darkorange\"), main = \"Delivery Time Distribution\", ylab = \"Time in Days\", xaxt=\"n\")\nlegend(\"topleft\", bty=\"n\",c(\"Not Returned\", \"Returned\"), fill = c(\"yellow\", \"orange\"))\nbeanplot(price ~ returnShipment, orders.sample, side = \"b\", col = list(\"yellow\", \"orange\"), border = c(\"yellow2\",\"darkorange\"), main = \"Price Distribution\", xaxt=\"n\")\nlegend(\"topleft\", bty=\"n\",c(\"Not Returned\", \"Returned\"), fill = c(\"yellow\", \"orange\"))\n\n# Mean & count of response given nominal vars\n# Only doing ones with few possible values- salutation & state\nsummaryBy(returnShipment ~ salutation, orders.train, FUN=c(length,mean))\nsummaryBy(returnShipment ~ state, orders.train, FUN=c(length,mean))\n\n# More EDA - a breakout of stats by returnShipment\ndescribeBy(orders.train, group=orders.train$returnShipment, mat=FALSE, type=3, digits=6)\n\n# quick X vs Y plot\nplot(orders.sample, cex=0.1)\n\n# calculate customer's preferred size\n# this was WAY more complicated than necessary...\n# mvf = most frequent value (a.k.a mode), requires Modeest package and library\n# Crap - have to make # obs match orders.sample\n# also, why does this create 3 variables instead of 1?\ncustMode <- summaryBy(size ~ customerID, data=orders.sample, FUN = function (x) {c(m=mfv(x))})\ncustMode\n\ncustMode <- customer\n\n  # sorting orders by customerID to cbind customer Mode to right observation\n  r <- order(orders.sample$customerID)\n  r\n  sortID <- orders.sample[r,]\n  sortID\ncbind(sortID,custMode[,2])\n\n# Add column to denote whether the order size was not the customer's usual order (size mode)\n# had to use custMode column instead of one cbinded in. Not sure why, but this works \nsortID$OrdNotMode <- ifelse((sortID$size != custMode[,2]),0,1)\nsortID$OrdNotMode\n\n     beanplot(sortID$OrdNotMode ~ returnShipment, sortID, side = \"b\", col = list(\"yellow\", \"orange\"), border = c(\"yellow2\",\"darkorange\"), main = \"Unusual Size?\", xaxt=\"n\")\n     legend(\"topleft\", bty=\"n\",c(\"Not Returned\", \"Returned\"), fill = c(\"yellow\", \"orange\"))\n\n# let's try this again...\n#nope\nmfv(orders.sample$size, group=orders.sample$customerID)\nmfv(orders.sample$size)\n\n#nope\nmyfun<-function(x){mfv(x)}\n  summaryBy(orders.sample$size~orders.sample$customerID, data=orders.sample, FUN=myfun)\n\n# nope\nOB <- orderBy(~orders.sample$customerID+orders.sample$size, data=orders.sample)\n  OM <- function(d){c(NA,mfv(orders.sample$size)}\n  v<-lapplyBy(~orders.sample$customerID, data=orders.sample, OM)\n  orders.sample$OM <-unlist(v)\n\n\n",
    "created" : 1397408141164.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2329839429",
    "id" : "95F0739B",
    "lastKnownWriteTime" : 1397437326,
    "path" : "~/GitHub/CAPSTONE/DMC_KT.r",
    "project_path" : "DMC_KT.r",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}